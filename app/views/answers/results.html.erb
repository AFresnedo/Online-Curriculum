<%# NOTE variables, for clarity and reducing DB hits %>
<% answer = @problem.answer %>
<% graph = Graph.find_by(file_id: @problem.id, typ: 'prob') %>
<% makeup = graph.makeup %>
<% metadata = @problem.metadata %>
<% score = Score.find_by(user_id: current_user.id, problem_id: @problem.id) %>

<%# problem statement %>
<h3>Problem</h3>
<div class="well">
  <%== @problem.text %>
</div>
<%# value comparison, so student knows how they fared before seeing solution %>
<div class="well">
  <div class="container">
    <div class="row">
      <div class="col-sm-6">
        <h4>Expected:</h4>
        <p><%== answer_list(answer.answers, 'a') %></p>
      </div>
      <div class="col-sm-6">
        <h4>Given:</h4>
        <p><%== answer_list(@userAnswers, 'b') %></p>
      </div>
    </div>
  </div>
</div>
<%# print solution+hint(s) combo(s) %>
<h3>Solution(s)</h3>
<% @problem.solutions.each do |solution| %>
  <div class="well">
    <b><%= "Type of solution: " %></b>
    <em><%= solution.typ %></em>
    <br>
    <br>
    <%== solution.text %>
    <br>
    <br>
    <h4>Hints related to this solution:</h4>
    <ol>
      <% solution.hints.each do |hint| %>
        <li><%== hint.text %></li>
      <% end %>
    </ol>
  </div>
<% end %>
<h3>Scores</h3>
<div class="well">
  <% if makeup %>
    <p><b>Points awarded:</b> <%= score.score %></p>
  <% else %>
    <p><b>Points awarded:</b> <%= score.score %></p>
  <% end %>
  <p><%= @feedback %></p>
  <ul>
    <li>Context: <%= Score.context_score(current_user.id, @problem.context) %></li>
    <li>Category: <%= Score.category_score(current_user.id, @problem.category) %></li>
    <li>Curriculum: <%= Score.curriculum_score(current_user.id, @problem.curriculum) %></li>
    <li>Everything: <%= Score.total_score(current_user.id) %></li>
  </ul>
</div>
<%# TODO the following problem details should be a partial %>
<div class="well">
  <h4>Problem details:</h4>
  <p><b>Curriculum: &nbsp</b>
  <em><%= @problem.curriculum %></em></p>
  <p><b>Category: &nbsp</b>
  <em><%= @problem.category %></em></p>
  <p><b>Context: &nbsp</b>
  <em><%= @problem.context %></em></p>
  <p><b>Difficulty: &nbsp</b>
  <em><%= metadata.diff %></em></p>
  <p><b>Source: &nbsp</b>
  <em><%= metadata.source %></em></p>
</div>

<p><%= link_to "Next", next_path(context: @problem.context) %></p>
<p><%= link_to "Back to Contexts", resume_path(curriculum: @problem.curriculum) %></p>

<script>
highlightAnswers('a','b', <%= @userAnswers.length %>)
</script>
